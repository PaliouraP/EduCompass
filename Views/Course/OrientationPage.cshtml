@model Tuple<List<Coefficient>, List<CourseHasCoefficient>, List<Course>, List<CourseQuizGrade>, List<PrerequisiteCourse>>

@{
    ViewData["Title"] = "OrientationPage";
}

@section Styles
{
    <link rel="stylesheet" href="~/css/courses.css" />
}

<!--TODO: ADD ORIENTATION TOTAL GRADE-->
<div class="px-5 py-5">
    <div class="subjects-head">
        <h3 class="my-4">Τα μαθήματα μου</h3>
    </div>
    <div class="orientations mt-3">
        <div class="row pt-1">
            <p>Για να ξεκλειδώσετε ένα μάθημα πρέπει να έχετε προσβάσιμο βαθμό στα προαπαιτούμενά του. Για να ξεκλειδώσετε το επαναληπτικό τεστ πρέπει να έχετε προσβάσιμο βαθμό σε όλα τα μαθήματα του συγκεκριμένου προσανατολισμού.</p>
        </div>
        
        @{
            int i = 0;
            int j = 0;
        }

        @foreach (Coefficient coefficient in Model.Item1)
        {
            <div class="orientation-template px-4 py-3">
 
                <a data-bs-toggle="collapse" href="#coefficient-@i" role="button" aria-expanded="false"
                   aria-controls="collapseExample" class="row details collapsed">
                    <div class="col-8">
                        <div class="orientation-title">
                            @coefficient.NameInGreek
                        </div>
                        <div class="orientation-progress ">
                            2/4 <!-- Πόσα μαθήματα έχεις περάσει - replace with actual value-->
                        </div>
                    </div>
                    <div class="expand-arrow d-flex justify-content-end align-items-center col-4">
                        <i class="fas fa-arrow-circle-right" aria-hidden="true"></i>
                        <i class="fas fa-arrow-circle-down" aria-hidden="true"></i>
                    </div>
                </a>

                <div class="collapse subjects-list my-4" id="coefficient-@i">
                    <div class="subjects-list">

                        @foreach (Course course in Model.Item3)
                        {
                            <!-- Εμφάνισε μαθήματα που 'ναι μέσα σε αυτό το coefficient -->
                            @if (!Model.Item2.Any(cc => cc.CoefficientName == coefficient.Name && course.Id == cc.CourseId && cc.Value > 0))
                                continue;

                            <!-- Show the Grade. If there is no grade, show 0 -->
                            var grade = 0;
                            var gradeObject = Model.Item4.Where(g => g.CourseId == course.Id).ToArray();
                            if (gradeObject.Any())
                                grade = gradeObject[0].Grade;

                            <!-- Locking ability. If this course is a prerequisite of another and has a score less than 50 "lock" it. -->
                            var thisCourseIsPrerequisite = Model.Item5.Where(pc => pc.BaseCourseId == course.Id).ToList();
                            var locked = false;
                            foreach (var prerequisiteCourse in thisCourseIsPrerequisite)
                            {
                                if (Model.Item4.Any(g => g.CourseId == prerequisiteCourse.PrerequisiteCourseId && g.Grade < 50))
                                    locked = true;
                            }

                            <!-- TODO: add locked ability -->
                            <div class="subject-card">
                                <label for="file"> @course.Name 
                                    
                                    @if (locked)
                                    {
                                        <b>🔒</b>
                                    }
                                    else
                                    {
                                        <a asp-controller="Course" asp-route-uuid="@course.UUID" asp-action="CoursePage">
                                            <i class="fas fa-link hyperlink"></i></a>
                                    }
                                </label>
                                
                                <br/>
                                
                                <progress id="progress-@j" value="@grade" max="100"> </progress>
                                <script>
                                    check_value('progress-@j');
                                </script>
                            </div>

                            {
                                j++;
                            }
                        }
                        

                    </div>
                <div class="row  d-flex justify-content-evenly pt-1">
                    <!--if locked href empty and add locked icon-->
                    <a href="#" class="btn-long-alt-2  d-flex justify-content-center align-items-center">Επαναληπτικό Τεστ<span title="Χρειάζεστε προσβάσιμο βαθμό σε όλα τα μαθήματα του προσανατολισμού."><i class="fas fa-lock locked mx-2"></i></span></a>

                </div>
                </div>
            </div>
            
            {
                i++;
            }
        }




    </div>
</div>
        

